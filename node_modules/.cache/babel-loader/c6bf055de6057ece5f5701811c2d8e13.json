{"ast":null,"code":"'use strict';\n\nvar _classCallCheck = require(\"/Users/wbarakzai/Documents/1.Spring20/Athenomics/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/classCallCheck\");\n\nvar _createClass = require(\"/Users/wbarakzai/Documents/1.Spring20/Athenomics/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/createClass\");\n\nvar AbortController = require('abort-controller');\n\nvar SubscriptionTracker = /*#__PURE__*/function () {\n  function SubscriptionTracker() {\n    _classCallCheck(this, SubscriptionTracker);\n\n    this._subs = new Map();\n  }\n\n  _createClass(SubscriptionTracker, [{\n    key: \"subscribe\",\n    value: function subscribe(topic, handler, signal) {\n      var _this = this;\n\n      var topicSubs = this._subs.get(topic) || [];\n\n      if (topicSubs.find(function (s) {\n        return s.handler === handler;\n      })) {\n        throw new Error(\"Already subscribed to \".concat(topic, \" with this handler\"));\n      } // Create controller so a call to unsubscribe can cancel the request\n\n\n      var controller = new AbortController();\n\n      this._subs.set(topic, [{\n        handler: handler,\n        controller: controller\n      }].concat(topicSubs)); // If there is an external signal, forward the abort event\n\n\n      if (signal) {\n        signal.addEventListener('abort', function () {\n          return _this.unsubscribe(topic, handler);\n        });\n      }\n\n      return controller.signal;\n    }\n  }, {\n    key: \"unsubscribe\",\n    value: function unsubscribe(topic, handler) {\n      var subs = this._subs.get(topic) || [];\n      var unsubs;\n\n      if (handler) {\n        this._subs.set(topic, subs.filter(function (s) {\n          return s.handler !== handler;\n        }));\n\n        unsubs = subs.filter(function (s) {\n          return s.handler === handler;\n        });\n      } else {\n        this._subs.set(topic, []);\n\n        unsubs = subs;\n      }\n\n      unsubs.forEach(function (s) {\n        return s.controller.abort();\n      });\n    }\n  }], [{\n    key: \"singleton\",\n    value: function singleton() {\n      if (SubscriptionTracker.instance) return SubscriptionTracker.instance;\n      SubscriptionTracker.instance = new SubscriptionTracker();\n      return SubscriptionTracker.instance;\n    }\n  }]);\n\n  return SubscriptionTracker;\n}();\n\nmodule.exports = SubscriptionTracker;","map":null,"metadata":{},"sourceType":"script"}